---
import Base from './Base.astro'
import '@/components/admin/admin.css'

export const prerender = false

interface Props {
  title?: string
  activePage?: string
}

const { title = '管理后台', activePage = '' } = Astro.props
const fullTitle = `${title} - Tsuki 管理后台`
---

<Base title={fullTitle} noindex={true}>
  <div class="admin-layout" id="admin-layout">
    <!-- Mobile hamburger -->
    <button
      class="admin-hamburger"
      id="admin-hamburger"
      type="button"
      aria-label="打开菜单"
    >
      &#9776;
    </button>

    <!-- Overlay for mobile -->
    <div class="admin-overlay" id="admin-overlay"></div>

    <!-- Sidebar -->
    <aside class="admin-sidebar" id="admin-sidebar">
      <div class="admin-sidebar-brand">Tsuki 管理后台</div>
      <ul class="admin-sidebar-nav">
        <li>
          <a
            class="admin-sidebar-link"
            href="/admin"
            aria-current={activePage === 'home' ? 'page' : undefined}
          >
            首页
          </a>
        </li>
        <li>
          <a
            class="admin-sidebar-link"
            href="/admin/comments"
            aria-current={activePage === 'comments' ? 'page' : undefined}
          >
            评论管理
          </a>
        </li>
      </ul>
      <div class="admin-sidebar-footer">
        <a class="admin-sidebar-back" href="/">
          &larr; 返回前台
        </a>
      </div>
    </aside>

    <!-- Main area -->
    <div class="admin-main">
      <header class="admin-topbar">
        <span class="admin-topbar-title">{title}</span>
        <div class="admin-topbar-actions">
          <a class="admin-topbar-link" href="/">返回前台</a>
        </div>
      </header>
      <div class="admin-content">
        <slot />
      </div>
    </div>
  </div>

  <script is:inline>
    // Mobile sidebar toggle
    (function() {
      const hamburger = document.getElementById('admin-hamburger');
      const sidebar = document.getElementById('admin-sidebar');
      const overlay = document.getElementById('admin-overlay');
      if (!hamburger || !sidebar || !overlay) return;

      function toggle() {
        var open = sidebar.classList.toggle('is-open');
        overlay.classList.toggle('is-open');
        hamburger.style.opacity = open ? '0' : '';
        hamburger.style.pointerEvents = open ? 'none' : '';
      }

      hamburger.addEventListener('click', toggle);
      overlay.addEventListener('click', toggle);
    })();
  </script>
</Base>
