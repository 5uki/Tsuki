---
import Admin from '@/layouts/Admin.astro'

export const prerender = false
---

<Admin title="首页" activePage="home">
  <div id="admin-home-root">
    <div class="admin-auth-loading">验证权限中...</div>
  </div>
</Admin>

<script>
  import { getCurrentUser } from '@/lib/api'

  async function initAdminHome() {
    const root = document.getElementById('admin-home-root')
    if (!root) return

    try {
      const user = await getCurrentUser()

      if (!user || user.role !== 'admin') {
        root.innerHTML = `
          <div class="admin-forbidden">
            <div class="admin-forbidden-code">403</div>
            <p class="admin-forbidden-text">无权访问</p>
            <p class="admin-forbidden-hint">此页面仅限管理员访问</p>
            <a class="admin-forbidden-link" href="/">返回首页</a>
          </div>
        `
        return
      }

      root.innerHTML = `
        <div class="admin-home">
          <h1 class="admin-home-title">欢迎回来，${user.login}</h1>
          <p class="admin-home-subtitle">Tsuki 管理后台</p>
          <div class="admin-quick-links">
            <a class="admin-quick-link" href="/admin/comments">
              <span class="admin-quick-link-title">评论管理</span>
              <span class="admin-quick-link-desc">审核、隐藏或恢复评论</span>
            </a>
            <a class="admin-quick-link" href="/">
              <span class="admin-quick-link-title">返回前台</span>
              <span class="admin-quick-link-desc">查看博客前台页面</span>
            </a>
          </div>
        </div>
      `
    } catch {
      root.innerHTML = `
        <div class="admin-forbidden">
          <div class="admin-forbidden-code">403</div>
          <p class="admin-forbidden-text">无权访问</p>
          <p class="admin-forbidden-hint">请先登录管理员账号</p>
          <a class="admin-forbidden-link" href="/">返回首页</a>
        </div>
      `
    }
  }

  initAdminHome()
</script>
