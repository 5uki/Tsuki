---
import Default from '@/layouts/Default.astro'
import TableOfContents from '@/components/TableOfContents.astro'
import { createAppContext } from '@entry/index'
import { getMomentDetail, getMoments } from '@usecases/content'

export async function getStaticPaths() {
  const ctx = createAppContext()
  const moments = await getMoments(ctx)
  return moments.map((moment) => ({ params: { id: moment.id } }))
}

const { id } = Astro.params
const ctx = createAppContext()
const moment = await getMomentDetail(ctx, id)
---

<Default title="动态" description="动态详情">
  {moment ? (
    <>
      <article
        class="tsuki-content-card tsuki-card-transition rounded-[var(--tsuki-sidebar-card-radius)] border border-[var(--tsuki-sidebar-card-border)] bg-[var(--tsuki-sidebar-card-bg)] px-[var(--tsuki-space-1-5)] py-[var(--tsuki-space-1-75)] shadow-[var(--tsuki-sidebar-card-shadow)]"
        transition:name="page-card"
      >
        <header class="mb-[var(--tsuki-space-1-5)] border-b border-[var(--tsuki-surface-border)] pb-[var(--tsuki-space-1)]">
          <h1 class="mb-[var(--tsuki-space-0-5)] text-[length:var(--tsuki-text-2xl)] text-[color:var(--tsuki-fg)]">
            {moment.frontmatter.title}
          </h1>
          <div class="flex flex-wrap items-center gap-[var(--tsuki-space-0-6)] text-[length:var(--tsuki-text-sm)] text-[color:var(--tsuki-post-muted-fg)]">
            <time datetime={moment.frontmatter.publishedAt}>{moment.frontmatter.publishedAt}</time>
          </div>
        </header>
        <div class="prose">
          <moment.Content />
        </div>
      </article>
      <div slot="right">
        <TableOfContents headings={moment.headings} />
      </div>
    </>
  ) : (
    <div class="tsuki-content-card rounded-[var(--tsuki-sidebar-card-radius)] border border-[var(--tsuki-sidebar-card-border)] bg-[var(--tsuki-sidebar-card-bg)] px-[var(--tsuki-space-1-5)] py-[var(--tsuki-space-1-75)] shadow-[var(--tsuki-sidebar-card-shadow)]">
      <p class="m-0 text-[length:var(--tsuki-text-sm)] text-[color:var(--tsuki-fg)]">
        未找到动态 {id}
      </p>
    </div>
  )}
</Default>
