---
import Default from '@/layouts/Default.astro'
import TableOfContents from '@/components/TableOfContents.astro'
import { createAppContext } from '@entry/index'
import { getMomentDetail, getMomentEntries } from '@usecases/content'

export const prerender = true

export async function getStaticPaths() {
  const ctx = createAppContext()
  const moments = await getMomentEntries(ctx)
  return moments.map((moment) => ({ params: { id: moment.id } }))
}

const { id } = Astro.params
const ctx = createAppContext()
const moment = await getMomentDetail(ctx, id)
---

<Default title="动态" description="动态详情" hasRightSidebar={!!moment}>
  {moment ? (
    <article class="tsuki-content-card" transition:name="page-card">
      <header class="moment-header">
        <h1 class="moment-title">
          {moment.frontmatter.title}
        </h1>
        <div class="moment-meta">
          <time datetime={moment.frontmatter.publishedAt}>{moment.frontmatter.publishedAt}</time>
        </div>
      </header>
      <div class="prose">
        <moment.Content />
      </div>
    </article>
  ) : (
    <div class="tsuki-content-card">
      <p class="not-found-text">
        未找到动态 {id}
      </p>
    </div>
  )}
  <div slot="right">
    {moment && <TableOfContents headings={moment.headings} />}
  </div>
</Default>

<style>
  .moment-header {
    margin-bottom: var(--tsuki-space-1-5);
    border-bottom: 1px solid var(--tsuki-surface-border);
    padding-bottom: var(--tsuki-space-1);
  }

  .moment-title {
    margin-bottom: var(--tsuki-space-0-5);
    font-size: var(--tsuki-text-2xl);
    color: var(--tsuki-fg);
  }

  .moment-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--tsuki-space-0-6);
    font-size: var(--tsuki-text-sm);
    color: var(--tsuki-post-muted-fg);
  }

  .not-found-text {
    margin: 0;
    font-size: var(--tsuki-text-sm);
    color: var(--tsuki-fg);
  }
</style>
