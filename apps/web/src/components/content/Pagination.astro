---
interface Props {
  currentPage: number
  totalPages: number
  baseUrl: string
}

const { currentPage, totalPages, baseUrl } = Astro.props

function getPageUrl(page: number): string {
  return page === 1 ? `${baseUrl}/` : `${baseUrl}/${page}/`
}

function getPageNumbers(): (number | '...')[] {
  if (totalPages <= 7) {
    return Array.from({ length: totalPages }, (_, i) => i + 1)
  }
  const pages: (number | '...')[] = [1]
  const start = Math.max(2, currentPage - 1)
  const end = Math.min(totalPages - 1, currentPage + 1)
  if (start > 2) pages.push('...')
  for (let i = start; i <= end; i++) pages.push(i)
  if (end < totalPages - 1) pages.push('...')
  pages.push(totalPages)
  return pages
}

const pageNumbers = getPageNumbers()
---

<nav class="pagination" aria-label="分页导航">
  {currentPage > 1 && (
    <a href={getPageUrl(currentPage - 1)} class="page-link prev" aria-label="上一页">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="page-icon">
        <path d="m15 18-6-6 6-6"></path>
      </svg>
      上一页
    </a>
  )}
  <span class="page-numbers">
    {pageNumbers.map((p) =>
      p === '...' ? (
        <span class="page-ellipsis">...</span>
      ) : p === currentPage ? (
        <span class="page-link current" aria-current="page">{p}</span>
      ) : (
        <a href={getPageUrl(p)} class="page-link">{p}</a>
      )
    )}
  </span>
  {currentPage < totalPages && (
    <a href={getPageUrl(currentPage + 1)} class="page-link next" aria-label="下一页">
      下一页
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="page-icon">
        <path d="m9 18 6-6-6-6"></path>
      </svg>
    </a>
  )}
</nav>

<style>
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--tsuki-space-sm);
    margin-top: var(--tsuki-space-3xl);
    padding: var(--tsuki-space-lg) 0;
  }

  .page-numbers {
    display: flex;
    align-items: center;
    gap: var(--tsuki-space-2xs);
  }

  .page-link {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--tsuki-space-2xs);
    min-width: 2rem;
    height: 2rem;
    border-radius: var(--tsuki-radius-md);
    border: 1px solid var(--tsuki-surface-border);
    padding: 0 var(--tsuki-space-sm);
    font-size: var(--tsuki-text-sm);
    color: var(--tsuki-fg);
    text-decoration: none;
    transition: background-color var(--tsuki-motion-fast) var(--tsuki-motion-ease-out),
                border-color var(--tsuki-motion-fast) var(--tsuki-motion-ease-out),
                color var(--tsuki-motion-fast) var(--tsuki-motion-ease-out);
  }
  .page-link:hover:not(.current) {
    border-color: var(--tsuki-theme-accent);
    background: var(--tsuki-surface-accent);
    color: var(--tsuki-theme-accent);
  }

  .page-link.current {
    background: var(--tsuki-theme-accent);
    border-color: var(--tsuki-theme-accent);
    color: var(--tsuki-color-on-primary);
    cursor: default;
    font-weight: 600;
  }

  .page-link.prev,
  .page-link.next {
    padding: 0 var(--tsuki-space-md);
  }

  .page-icon {
    width: 1rem;
    height: 1rem;
  }

  .page-ellipsis {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 2rem;
    height: 2rem;
    font-size: var(--tsuki-text-sm);
    color: var(--tsuki-muted-fg);
  }
</style>
