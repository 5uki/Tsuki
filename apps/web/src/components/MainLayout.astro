---
import Profile from './Profile.astro'
import Announcement from './Announcement.astro'
import Categories from './Categories.astro'
import Tags from './Tags.astro'
import type { SidebarData } from '@contracts/content'

interface Props {
  class?: string
  sidebarData?: SidebarData
  hasRightSidebar?: boolean
}

const { class: className, sidebarData, hasRightSidebar = false } = Astro.props
---

<div
  class:list={['tsuki-main-grid', { 'has-right-sidebar': hasRightSidebar }, className]}
>
  <aside class="left-sidebar" transition:name="tsuki-sidebar" transition:animate="none">
    <Profile stats={sidebarData?.stats} />
    <Announcement />
    <Categories categories={sidebarData?.categories ?? []} />
    <Tags tags={sidebarData?.tags ?? []} />
  </aside>
  <main class="main-content">
    <slot />
  </main>
  {hasRightSidebar && (
    <aside class="right-sidebar" transition:name="tsuki-right-sidebar">
      <slot name="right" />
    </aside>
  )}
</div>

<style>
  .tsuki-main-grid {
    display: grid;
    width: 100%;
    align-items: start;
    gap: var(--tsuki-sidebar-gap-compact);
  }
  @media (min-width: 768px) {
    .tsuki-main-grid {
      gap: var(--tsuki-sidebar-gap);
      padding-inline: var(--tsuki-page-inline-padding);
      grid-template-columns: minmax(0, 1fr) minmax(0, 5fr);
    }
    .tsuki-main-grid.has-right-sidebar {
      grid-template-columns: minmax(0, 1fr) minmax(0, 4fr) minmax(0, 1fr);
    }
  }

  .left-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--tsuki-sidebar-gap-compact);
    order: -1;
  }
  @media (min-width: 768px) {
    .left-sidebar {
      order: 0;
      gap: var(--tsuki-sidebar-gap);
    }
  }

  .main-content {
    min-width: 0;
  }

  .right-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--tsuki-sidebar-gap-compact);
  }
  @media (min-width: 768px) {
    .right-sidebar {
      position: sticky;
      top: 1.5rem;
      align-self: start;
      gap: var(--tsuki-sidebar-gap);
    }
  }
</style>
