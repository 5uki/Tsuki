---
import type { PostCardItem } from '@atoms/post-cards'
import { Icon } from 'astro-icon/components'

interface Props {
  post: PostCardItem
  class?: string
}

const { post, class: className } = Astro.props
const postHref = `/posts/${post.slug}`
const hasCover = !!post.cover
---

<div
  class:list={[
    'post-card-wrapper group relative flex w-full flex-col-reverse overflow-hidden rounded-[var(--tsuki-sidebar-card-radius)] border border-[var(--tsuki-sidebar-card-border)] bg-[var(--tsuki-sidebar-card-bg)] shadow-[var(--tsuki-sidebar-card-shadow)] outline outline-1 outline-[var(--tsuki-sidebar-card-outline)] outline-offset-0 transition-[transform,box-shadow,border-color,outline-color] duration-[140ms] ease-[cubic-bezier(0.22,1,0.36,1)] hover:translate-y-[var(--tsuki-sidebar-card-hover-translate)] hover:border-[var(--tsuki-sidebar-card-border-hover)] hover:shadow-[var(--tsuki-sidebar-card-shadow-hover)] hover:outline-[var(--tsuki-sidebar-card-outline-hover)] active:shadow-[var(--tsuki-sidebar-card-shadow-active)] md:min-h-[12.8rem] md:flex-col',
    '[--tsuki-post-cover-width:30%]',
    {
      'has-cover': hasCover,
      'no-cover': !hasCover,
      'pinned border-[var(--tsuki-theme-accent)] hover:border-[var(--tsuki-theme-accent)]': !!post.pinned,
    },
    className,
  ]}
>
  <div
    class:list={[
      'post-card-content relative flex min-h-full flex-col p-6 md:py-7 md:pl-9 md:pr-2',
      {
        'md:w-[calc(100%-var(--tsuki-post-cover-width)-1.5rem)] md:min-h-[12.8rem]': hasCover,
        'md:w-full md:pr-9': !hasCover,
      },
    ]}
  >
    <a href={postHref} class="post-card-title group/title relative mb-3 inline-flex w-fit max-w-full items-center text-[var(--tsuki-text-4xl)] font-bold leading-[1.3] text-[color-mix(in_srgb,var(--tsuki-fg)_90%,transparent)] no-underline transition-colors duration-150 hover:text-[var(--tsuki-theme-accent)] focus-visible:text-[var(--tsuki-theme-accent)] md:max-w-[calc(100%-0.5rem)] md:before:absolute md:before:left-[-1.5rem] md:before:top-[0.35rem] md:before:h-[1.25rem] md:before:w-1 md:before:rounded-[var(--tsuki-radius-xs)] md:before:bg-[var(--tsuki-theme-accent)] md:before:content-['']">
      <span class="break-words">{post.title}</span>
      <span class="ml-[0.2rem] inline-block h-8 w-8 text-[var(--tsuki-text-arrow)] leading-none text-[var(--tsuki-theme-accent)] md:hidden" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m9 18 6-6-6-6"></path>
        </svg>
      </span>
      <span class="ml-[0.2rem] hidden h-8 w-8 text-[var(--tsuki-text-arrow)] leading-none text-[var(--tsuki-theme-accent)] opacity-0 transition-[opacity,transform] duration-150 md:inline-block md:-translate-x-[0.2rem] md:group-hover/title:translate-x-0 md:group-hover/title:opacity-100 md:group-focus-visible/title:translate-x-0 md:group-focus-visible/title:opacity-100" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m9 18 6-6-6-6"></path>
        </svg>
      </span>
    </a>

    <div class="post-meta mb-[0.7rem] flex flex-wrap items-center gap-x-[0.85rem] gap-y-[0.6rem]">
      {post.pinned && (
        <span class="meta-row pinned-row inline-flex min-w-0 items-center gap-[0.3rem] rounded-[var(--tsuki-radius-5sm)] bg-[var(--tsuki-pinned-bg)] px-[0.45rem] py-[0.2rem]">
          <span class="meta-icon-badge grid h-[1.56rem] w-[1.56rem] place-items-center rounded-[var(--tsuki-radius-4sm)] bg-[var(--tsuki-pinned-bg)]">
            <Icon name="material-symbols:pinboard" class="meta-icon inline-flex h-4 w-4 items-center justify-center text-[var(--tsuki-color-on-primary)]" />
          </span>
          <span class="meta-text whitespace-nowrap text-[var(--tsuki-text-base-tight)] font-medium leading-5 text-[var(--tsuki-color-on-primary)]">置顶</span>
        </span>
      )}

      <span class="meta-row date-row inline-flex min-w-0 items-center gap-[0.3rem]">
        <span class="meta-icon-badge grid h-[1.56rem] w-[1.56rem] place-items-center rounded-[var(--tsuki-radius-4sm)] border border-[var(--tsuki-chip-border)] bg-[var(--tsuki-chip-bg)]">
          <Icon name="material-symbols:calendar-today-outline-rounded" class="meta-icon inline-flex h-4 w-4 items-center justify-center text-[var(--tsuki-theme-accent)]" />
        </span>
        <time datetime={post.publishedAt} class="meta-text whitespace-nowrap text-[var(--tsuki-text-base-tight)] font-medium leading-5 text-[color-mix(in_srgb,var(--tsuki-fg)_60%,transparent)]">
          {post.publishedAt}
        </time>
      </span>

      <span class="meta-row inline-flex min-w-0 items-center gap-[0.3rem]">
        <span class="meta-icon-badge grid h-[1.56rem] w-[1.56rem] place-items-center rounded-[var(--tsuki-radius-4sm)] border border-[var(--tsuki-chip-border)] bg-[var(--tsuki-chip-bg)]">
          <Icon name="material-symbols:book-2-outline-rounded" class="meta-icon inline-flex h-4 w-4 items-center justify-center text-[var(--tsuki-theme-accent)]" />
        </span>
        <span class="meta-text whitespace-nowrap text-[var(--tsuki-text-base-tight)] font-medium leading-5 text-[color-mix(in_srgb,var(--tsuki-fg)_68%,transparent)]">{post.category}</span>
      </span>

      <span class="meta-row inline-flex min-w-0 items-center gap-[0.3rem]">
        <span class="meta-icon-badge grid h-[1.56rem] w-[1.56rem] place-items-center rounded-[var(--tsuki-radius-4sm)] border border-[var(--tsuki-chip-border)] bg-[var(--tsuki-chip-bg)]">
          <Icon name="material-symbols:article-outline-rounded" class="meta-icon inline-flex h-4 w-4 items-center justify-center text-[var(--tsuki-theme-accent)]" />
        </span>
        <span class="meta-text whitespace-nowrap text-[var(--tsuki-text-base-tight)] font-medium leading-5 text-[color-mix(in_srgb,var(--tsuki-fg)_68%,transparent)]">{post.words} 字</span>
      </span>
    </div>

    <p class="description mb-[0.85rem] pr-4 text-[var(--tsuki-text-md-tight)] leading-[1.7] text-[color-mix(in_srgb,var(--tsuki-fg)_74%,transparent)] [display:-webkit-box] [-webkit-line-clamp:2] [-webkit-box-orient:vertical] overflow-hidden">
      {post.summary}
    </p>

    <div class="stats mt-auto flex flex-wrap gap-2">
      {post.tags.map(tag => (
        <a href={`/tags/${tag.toLowerCase()}`} class="tag-item inline-flex items-center rounded-[var(--tsuki-radius-md)] bg-[var(--tsuki-tag-bg)] px-3 py-1.5 text-[var(--tsuki-text-sm)] font-medium text-[var(--tsuki-tag-fg)] transition-[background-color,transform] duration-150 ease-out hover:-translate-y-0.5 hover:bg-[var(--tsuki-tag-bg-hover)] max-sm:px-2.5 max-sm:py-[0.3125rem]">{tag}</a>
      ))}
    </div>
  </div>

  {hasCover && (
    <a href={postHref} class="post-card-image group/image relative block w-full overflow-hidden rounded-t-[var(--tsuki-sidebar-card-radius)] rounded-b-[0px] aspect-[2/1] transition-transform duration-150 ease-out active:scale-[0.95] md:absolute md:right-4 md:top-4 md:bottom-4 md:h-[calc(100%-2rem)] md:w-[var(--tsuki-post-cover-width)] md:rounded-[var(--tsuki-radius-lg)] md:aspect-auto" aria-label={`阅读 ${post.title}`}>
      <img src={post.cover} alt="" class="cover-image block h-full w-full object-cover transition-transform duration-200 ease-out group-hover/image:scale-[1.03]" loading="lazy" decoding="async" />
    </a>
  )}
</div>
