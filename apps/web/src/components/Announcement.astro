---
import tsukiConfig from '@/config/tsuki-config'

const { announcement } = tsukiConfig
const isExternalLink = (url?: string) => !!url && /^https?:\/\//i.test(url)
---

{announcement?.enable && (
  <div class="tsuki-sidebar-card">
    {announcement.title && (
      <h3 class="tsuki-section-title">
        {announcement.title}
      </h3>
    )}
    {announcement.content && (
      <div class="announcement-content" set:html={announcement.content} />
    )}
    {announcement.link?.enable && announcement.link.url && (
      <a
        href={announcement.link.url}
        target={isExternalLink(announcement.link.url) ? '_blank' : undefined}
        rel={isExternalLink(announcement.link.url) ? 'noopener noreferrer' : undefined}
        class="announcement-link"
      >
        {announcement.link.text || '查看详情'}
      </a>
    )}
  </div>
)}

<style>
  .announcement-content {
    margin-bottom: var(--tsuki-space-0-75);
    font-size: var(--tsuki-sidebar-body-text-size);
    line-height: var(--tsuki-line-height-snug);
    color: var(--tsuki-fg);
  }
  .announcement-content :global(p) {
    margin-bottom: var(--tsuki-space-0-5);
  }
  .announcement-content :global(p:last-child) {
    margin-bottom: 0;
  }
  @media (min-width: 640px) {
    .announcement-content {
      font-size: var(--tsuki-sidebar-body-text-size-desktop);
    }
  }

  .announcement-link {
    margin-top: auto;
    display: inline-flex;
    align-items: center;
    align-self: flex-end;
    border-radius: var(--tsuki-radius-md);
    background: var(--tsuki-theme-secondary);
    padding: var(--tsuki-space-0-35) var(--tsuki-space-0-9);
    font-size: var(--tsuki-sidebar-body-text-size);
    font-weight: 500;
    color: var(--tsuki-fg);
    text-decoration: none;
    transition: opacity var(--tsuki-motion-fast) var(--tsuki-motion-ease-out),
                transform var(--tsuki-motion-fast) var(--tsuki-motion-ease-out);
  }
  .announcement-link:hover {
    transform: translateY(var(--tsuki-translate-1px));
    opacity: 0.9;
  }
  @media (min-width: 640px) {
    .announcement-link {
      font-size: var(--tsuki-sidebar-body-text-size-desktop);
    }
  }
</style>
