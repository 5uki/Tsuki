---
import tsukiConfig from '@/config/tsuki-config'

const { announcement } = tsukiConfig
const isExternalLink = (url?: string) => !!url && /^https?:\/\//i.test(url)
---

{announcement?.enable && (
  <div class="announcement-widget sidebar-card">
    {announcement.title && <h3 class="announcement-title">{announcement.title}</h3>}
    {announcement.content && (
      <div class="announcement-content" set:html={announcement.content} />
    )}
    {announcement.link?.enable && announcement.link.url && (
      <a
        href={announcement.link.url}
        target={isExternalLink(announcement.link.url) ? '_blank' : undefined}
        rel={isExternalLink(announcement.link.url) ? 'noopener noreferrer' : undefined}
        class="announcement-link"
      >
        {announcement.link.text || '查看详情'}
      </a>
    )}
  </div>
)}

<style>
  .announcement-widget {
    display: flex;
    flex-direction: column;
  }

  .announcement-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.75rem;
    color: var(--tsuki-fg);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .announcement-title::before {
    content: '';
    width: 4px;
    height: 1rem;
    background: var(--tsuki-primary);
    border-radius: 2px;
  }

  .announcement-content {
    font-size: 0.875rem;
    color: var(--tsuki-muted);
    line-height: 1.6;
    margin-bottom: 0.75rem;
  }

  .announcement-content :deep(p) {
    margin: 0 0 0.5rem;
  }

  .announcement-content :deep(p:last-child) {
    margin-bottom: 0;
  }

  .announcement-link {
    display: inline-flex;
    align-items: center;
    align-self: flex-end;
    margin-top: auto;
    padding: 0.35rem 0.9rem;
    background: var(--tsuki-primary);
    color: white;
    border-radius: 0.5rem;
    font-size: 0.8125rem;
    font-weight: 500;
    text-decoration: none;
    transition: opacity 0.15s, transform 0.15s;
  }

  .announcement-link:hover {
    opacity: 0.9;
    transform: translateY(-1px);
    text-decoration: none;
  }

  @media (max-width: 640px) {
    .announcement-title {
      font-size: 0.9375rem;
    }

    .announcement-content {
      font-size: 0.8125rem;
    }
  }
</style>
