---
// 横幅组件 - 首页顶部展示区域,包含标题和波浪动画
import tsukiConfig from '@/config/tsuki-config'

const title = tsukiConfig.hero?.title
const subtitle = tsukiConfig.hero?.subtitle
const fallbackTitle = tsukiConfig.site.title
const fallbackSubtitle = tsukiConfig.site.description

const isHome = Astro.url.pathname === '/'
---

<section class="tsuki-banner" aria-label="Banner">
  <div class="tsuki-banner-content" data-home={isHome ? '' : undefined}>
    <h1 class="tsuki-banner-title">{title || fallbackTitle}</h1>
    <p class="tsuki-banner-subtitle">{subtitle || fallbackSubtitle}</p>
  </div>

  <div id="header-waves" class="tsuki-banner-waves waves" aria-hidden="true">
    <svg
      class="waves"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 24 150 28"
      preserveAspectRatio="none"
      shape-rendering="geometricPrecision"
    >
      <defs>
        <path
          id="gentle-wave"
          d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v48h-352z"></path>
        <linearGradient id="tsuki-banner-wave-gradient" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="var(--tsuki-banner-wave-top, var(--tsuki-banner-wave-fill))"
          ></stop>
          <stop
            offset="100%"
            stop-color="var(--tsuki-banner-wave-bottom, var(--tsuki-banner-wave-fill))"></stop>
        </linearGradient>
      </defs>
      <g class="parallax">
        {
          [
            { y: 0, opacity: 0.35, dur: '10s', begin: '-2s' },
            { y: 3, opacity: 0.6, dur: '14s', begin: '-4s' },
            { y: 5, opacity: 0.78, dur: '20s', begin: '-6s' },
            { y: 7, opacity: 0.92, dur: '28s', begin: '-8s' },
          ].map((w) => (
            <use xlink:href="#gentle-wave" x="48" y={w.y} opacity={w.opacity}>
              <animateTransform
                attributeName="transform"
                type="translate"
                values="-90 0; 90 0; -90 0"
                dur={w.dur}
                repeatCount="indefinite"
                begin={w.begin}
                calcMode="spline"
                keySplines="0.45 0.05 0.55 0.95; 0.45 0.05 0.55 0.95"
                keyTimes="0;0.5;1"
              />
            </use>
          ))
        }
      </g>
    </svg>
  </div>
</section>

<style is:global>
  .tsuki-banner {
    position: relative;
    height: var(--tsuki-banner-height);
    transition: height var(--tsuki-vt-duration, 380ms) var(--tsuki-vt-ease, ease);
    overflow-anchor: none;
    margin-top: calc(-1 * var(--tsuki-header-overlap-block-size));
    padding: var(--tsuki-header-overlap-block-size) var(--tsuki-banner-inline-padding)
      var(--tsuki-banner-wave-height);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    isolation: isolate;
    overflow: hidden;
  }

  .tsuki-banner::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: 0;
    background-image: var(--tsuki-banner-image);
    background-repeat: no-repeat;
    background-size: cover;
    background-position: var(--tsuki-banner-image-position-x, 50%)
      var(--tsuki-banner-image-position-y, 50%);
    opacity: var(--tsuki-banner-image-opacity);
    filter: var(--tsuki-banner-image-filter);
    mask-image: var(--tsuki-banner-image-mask);
    mask-size: 100% 100%;
    mask-repeat: no-repeat;
    -webkit-mask-image: var(--tsuki-banner-image-mask);
    -webkit-mask-size: 100% 100%;
    -webkit-mask-repeat: no-repeat;
    pointer-events: none;
  }

  .tsuki-banner-content {
    position: relative;
    z-index: 1;
    width: min(100%, var(--tsuki-banner-content-max-width));
    padding: 0;
  }

  .tsuki-banner-title {
    margin: 0 0 var(--tsuki-banner-title-gap);
    font-size: var(--tsuki-banner-title-size);
    font-weight: 700;
    line-height: 1.08;
    color: var(--tsuki-banner-title-fg);
    text-shadow: var(--tsuki-shadow-banner-title);
    letter-spacing: -0.02em;
    transition:
      opacity 280ms ease,
      transform 280ms ease;
  }

  .tsuki-banner-subtitle {
    margin: 0;
    font-size: var(--tsuki-banner-subtitle-size);
    font-weight: 400;
    line-height: 1.65;
    color: var(--tsuki-banner-subtitle-fg);
    text-shadow: var(--tsuki-shadow-banner-subtitle);
    transition:
      opacity 280ms ease,
      transform 280ms ease;
  }

  .tsuki-banner-content:not([data-home]) .tsuki-banner-title,
  .tsuki-banner-content:not([data-home]) .tsuki-banner-subtitle {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
  }

  .tsuki-banner-waves {
    position: absolute;
    left: 0;
    right: 0;
    bottom: -1px;
    height: var(--tsuki-banner-wave-height);
    max-height: var(--tsuki-banner-wave-max-height);
    min-height: var(--tsuki-banner-wave-min-height);
    overflow: visible;
    z-index: 5;
    transform: translateZ(0);
    pointer-events: none;
    filter: blur(var(--tsuki-banner-wave-blur));
  }

  .tsuki-banner-waves svg {
    width: 100%;
    height: 100%;
    display: block;
  }

  .tsuki-banner-waves use {
    fill: url(#tsuki-banner-wave-gradient);
  }

  @media (prefers-reduced-motion: reduce) {
    .tsuki-banner-waves animateTransform {
      dur: 0s;
    }
  }

  @media (max-width: 640px) {
    .tsuki-banner {
      padding-left: var(--tsuki-banner-inline-padding-mobile);
      padding-right: var(--tsuki-banner-inline-padding-mobile);
    }
  }

  @media (min-width: 768px) {
    .tsuki-banner-waves {
      height: var(--tsuki-banner-wave-height-md);
    }
  }
</style>
