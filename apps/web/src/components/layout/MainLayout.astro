---
import Profile from '../sidebar/Profile.astro'
import Announcement from '../sidebar/Announcement.astro'
import SidebarList from '../sidebar/SidebarList.astro'
import Tags from '../sidebar/Tags.astro'
import type { SidebarData } from '@/lib/types/content'

interface Props {
  class?: string
  sidebarData?: SidebarData
}

const { class: className, sidebarData } = Astro.props
---

<div class:list={['tsuki-main-grid', className]}>
  <main class="main-content" id="swup">
    <div class="transition-main">
      <slot />
    </div>
  </main>

  <aside class="left-sidebar" id="left-sidebar-panel">
    <Profile stats={sidebarData?.stats} />
    <Announcement />
    <SidebarList title="分类" items={sidebarData?.categories ?? []} queryKey="category" />
    <Tags tags={sidebarData?.tags ?? []} />
  </aside>

  <aside class="right-sidebar" id="swup-right">
    <slot name="right" />
  </aside>
</div>

<style>
  .tsuki-main-grid {
    display: grid;
    width: 100%;
    align-items: start;
    gap: var(--tsuki-sidebar-gap-compact);
    grid-template-columns: minmax(0, 1fr);
    grid-template-areas:
      'main'
      'right';
  }

  .main-content {
    min-width: 0;
    grid-area: main;
  }

  .left-sidebar {
    display: none;
    flex-direction: column;
    gap: var(--tsuki-sidebar-gap-compact);
    grid-area: left;
  }

  .right-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--tsuki-sidebar-gap-compact);
    grid-area: right;
  }

  @media (min-width: 768px) {
    .tsuki-main-grid {
      gap: var(--tsuki-sidebar-gap);
      grid-template-columns: minmax(12rem, 1fr) minmax(0, 3fr) minmax(12rem, 1fr);
      grid-template-areas: 'left main right';
    }

    .left-sidebar {
      display: flex;
      gap: var(--tsuki-sidebar-gap);
    }

    .main-content {
      min-width: 0;
    }

    .right-sidebar {
      align-self: stretch;
      gap: var(--tsuki-sidebar-gap);
    }
  }

  @media (min-width: 1600px) {
    .tsuki-main-grid {
      grid-template-columns: 1fr 1fr 3fr 1fr 1fr;
      grid-template-areas: '. left main right .';
    }
  }
</style>
